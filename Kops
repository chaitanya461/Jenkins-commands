curl -LO "https://dl.k8s.io/release/$(curl Ls https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl" 

wget https://github.com/kubernetes/kops/releases/download/v1.25.0/kops-linux-amd64

chmod +x kops-linux-amd64 kubectl

mv kubectl /usr/local/bin/kubectl

mv kops-linux-amd64 /usr/local/bin/kops

copy paste all at a time if required

vi.bashrc

export PATH=$PATH:/usr/local/bin/

wq!

source .bashrc

aws s3api create-bucket-bucket reyaz-kops-testbkt123.k8s.local-region ap-south-1-create-bucket-configuration

LocationConstraint-ap-south-1

aws s3api put-bucket-versioning-bucket reyaz-kops-testbkt123.k8s.local-region ap-south-1-versioning-configuration Status-Enabled

export KOPS_STATE_STORE=s3://reyaz-kops-testbkt123.k8s.local

kops create cluster-name reyaz.k8s.local-zones ap-south-la-master-count=1--master-size t2.medium-node-count-2-node-size t2.micro

kops update cluster-name reyaz.k8s.local-yes--admin

kops validate cluster --wait 10m
--------+++----------------------------------------
For Future Reference

Suggestions:

* list clusters with: kops get cluster

edit this cluster with: kops edit cluster reyaz.k8s.local

edit your node instance group: kops edit ig-name-reyaz.k8s.local nodes-ap-south-la

edit your master instance group: kops edit ig-name-reyaz.k8s.local master-ap-south-la

-----------------------------------------------------

kubectl get namespace/ns

kubectl get pods

kubectl get namespace/ns

kubectl get pods

kubectl describe pod [By default pods are created in default namespace]

kubectl get pods -A [This will list all pods from all namespaces]

kubectl get pods-all-namespaces [This can also be used to get all pods from all namespaces]

kubectl get pods -n default [This will list pods wchich is in default namespace]

kubectl get pods -n kube-node-release no pods here

kubectl get pods -n kube-public no pods here

kubectl get pods -n kube-system [all kubeproxy, apiserver, controller

---------------------------------------------------------

Scale Out Worker Nodes :

kops edit ig-name-reyaz.k8s.local nodes-ap-south-la --> max size 4, min size 4

kops update cluster-name reyaz.k8s.local-yes--admin

kops rolling-update cluster --yes

See in AWS Console, 2 additional worker nodes got created

kubectl get nodes. [takes time to show]

Scalle out Master Nodes:

kops edit ig-name-reyaz.k8s.local master-ap-south-la --> max size 2, min size 2

kops update cluster-name reyaz.k8s.local-yes-admin

kops rolling-update cluster --yes

See in AWS Console, 1 additional Master nodes got created

kubectl get nodes [takes time to show]

_--------------------------------------------------------

IF ERROR

Step 3: If Kubelet is Installed but Not Found in Systemd If kubelet is installed but still not found in systemd, try reloading systemd:

sudo systemctl daemon-reload

sudo systemctl restart kubelet

If the issue persists, manually add the systemd service file:

sudo nano /etc/systemd/system/kubelet.service

[Service]
ExecStart=/usr/bin/kubelet Restart always StartLimitInterval=0
RestartSec=10
[Install]
WantedBy=multi-user.target
Then reload and start:

sudo systemctl daemon-reload sudo systemctl enable kubelet sudo systemctl restart kubelet

Step 4: Check Logs for Errors If kubelet is still failing, check logs:

journalctl -u kubelet -f

----------------------------------------------------------

Lets create a pods in namespaces

kubectl get ns

kubectl create ns dev

kubectl get ns

Currently I am in default namespace, how to check

kubectl config view [ output doesn't show namespace, if you don't see any namespace, this is default]

kubectl config set-context-current-namespace dev [This is use to switch to move from another namespace]

kubectl config view [ Now this output show dev namespace]

kubectl get pods [Now you are in dev namespace, now you cannot see any pods of other namespace] I

create a new pods in this namespace

kubectl run devi-image nginx

kubectl run dev2-image nginx

kubectl run dev3image nginx

kubectl get pods

----+++-----------------------------------------------------

Create a namespace in kubernetes :

kubectl create ns dev [use if already exits]

kubectl config set-context-current-namespace-dev

First create a sample serviceaccount here in kubernetes called jack

Create a Serviceaccount--> Create a ROLE(give permissions)--> Role Binding

vi serviceaccount.yml

apiVersion: v1
kind: ServiceAccount
metadata:
  name: jack
  namespace: dev


kubectl create -f serviceaccount.yml

Create a Role within the dev namespace that allows the user jack to perform certain actions on pods:

vi role.yml

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev
  name: dev-pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

kubectl create -f role.yml

Since pods belong to the core API group, we use apiGroups: [""]

Next, bind the pod-reader Role to a user or service account. For simplicity, we'll bind it to a service

account jack:

This RoleBinding binds the pod-reader Role to the jack user, allowing that user to get, list, and watch pods in th dev namespace.

vi rolebinding.yml

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: dev
subjects:
- kind: User
  name: jack
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: dev-pod-reader
  apiGroup: rbac.authorization.k8s.io

kubectl create f rolebinding.yml

Verifying Access

To verify that the jack user has the correct permissions, you can impersonate the user using kubectl:

kubectl auth can-i list pods --namespace=dev --as=jack [answer yes]

kubectl auth can-i create pods --namespace=dev --as=jack [answer no]

kubectl get roles -n dev [List all roles in a namespace:

kubectl describe rolebinding read-pods -n dev

----+++-----------------------------------------------------

