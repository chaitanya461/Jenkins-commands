vi app.py

from flask import Flask
import socket

app = Flask(__name__)

@app.route('/')
def hello():
    # Format the string to include the actual hostname
    return f"Hello from {socket.gethostname()}!"

if __name__ == '__main__':
    # Remove the comma after app.run and ensure correct syntax
    app.run(host='0.0.0.0', port=5000)


#Create requirements.txt

vi requirements.txt

flask




vi Dockerfile

#Use Python base image FROM python:.9

#Set working directory. 
WORKDIR /app

#Copy and install dependencies

COPY requirements.txt

RUN pip install -r requirements.txt

#Copy the application code COPY

#Expose the port Flask runs on
 EXPOSE 5000

# Start the Flask app
 CMD ["python", "app.py"]


services:
  nginx:
    image: nginx:latest
    container_name: nginx_lb
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
      - "80:80"
    depends_on:
      - backend1
      - backend2
      - backend3

  backend1:
    build: .
    container_name: backend1
    expose:
      - "5000"

  backend2:
    build: .
    container_name: backend2
    expose:
      - "5000"

  backend3:
    build: .
    container_name: backend3
    expose:
      - "5000"



vi nginx.conf

upstream backend {
        server backend1:5000;
        server backend2:5000;
        server backend3:5000;
}


server {
        listen 80;

         location / {
                 proxy_pass http://backend;
                 proxy_set_header Host $host;
                 proxy_set_header X-Real-IP $remote_addr;
                 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                 proxy_set_header X-Forwarded-Proto $scheme;
         }
 }
