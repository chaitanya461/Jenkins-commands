FROM nginx:latest
#Remove default config and copy custom nginx.conf  
RUN rm /etc/nginx/conf.d/default.conf
COPY nginx.conf /etc/nginx/conf.d/
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]


upstream backend {

   server backend1:5000;

   server backend2:5001;

   server backend3:5002; 
}



server {

       listen 80;

       location / {

             proxy_pass http://backend;

             proxy_set_header Host $host;

             proxy_set_header X-Real-IP $remote_addr;

             proxy_set_header X-Forwarded-For      $proxy_add_x_forwarded_for;

             proxy_set_header X-Forwarded-Proto $scheme;

            }

}





version:

3.8

services:

nginx:

build:

container_name: nginx-lb

ports:

-"80:80"

depends_on:

backend1

backend2

backend3

backend1:

image: ghcr.to/benc-uk/python-demoapp

container name: backend 1

expose:"5000"

backend2:

umage: ghcr.to/benc-uk/python-demoapp

container name: backend2

expose: "5001"

backend3:

Usage: ghor.io/benc-uk/python-demoapp

container name: backend3

expose:"5002"
