HELM:

--In K8S Helm is a package manager to install packages

--in Redhat: yum & Ubuntu: apt & K8s: helm

--it is used to install applications on clusters.

--we can install and deploy applications by using helm

--it manages k8s resources packages through charts

--chart is a collection of files organized on a directory structure.

--chart is collection of manifest files.

--a running instance of a chart with a specific config is called a release.

--The Helm client and library is written in the Go programming language.

--The library uses the Kubernetes client library to communicate with Kubernetes.

ARCHITECURE:

1. HEML REPOSITORY: IT HAS AL HELM REPOS WHICH IS PUBLICALLY AVAILABLE

2. HEML CLIENT: DOWNLOADS HELM CHARTS FORM HELM REPOS.

3. API SERVER: DOWNLOADED HELM CHARTS WILL BE EXECUTED ON CLUSTER WITH API SERVER,

ARGOCD to do deployment in K8S Cluster

--Setup KOPS first and with the helm we will setup ARGOCD

Setup KOPS:

Install HELM:

curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3

chmod 700 get_helm.sh

./get_helm.sh

helm version

Install ARGOCD using HELM:

helm repo add argo https://argoproj.github.io/argo-helm

helm repo update

kubectl create namespace argocd

helm install argocd argo/argo-cd --namespace argocd

kubectl get all -n argocd

EXPOSE ARGOCD SERVER:

kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'

yum install jq -y

kubectl get svc argocd-server -n argocd -o json | jq --raw-output .status.loadBalancer.ingress[0].hostname

--The above command will provide load balancer URL to access ARGO CD

TO GET ARGO CD PASSWORD:

kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

Open ArgoCD load balancer

username: admin and password from above command

create app --> Application Name -->bankapp Project Name -> default --> Sync Policy Automatic Repository

--> https://github.com/ReyazShaik/ar-deploy.git --> Path --/-- CLuster URL -->

NameSpace -->default 

-----------------------------------------------------------

--Launch Amazonlinux2 instance call as Promotheus&Grafana Server, from this server we will create K8S CLuster and monitor all those

--Setup KOPS cluster first amazon Linux 2

Install HELM:

curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3

chmod 700 get_helm.sh

./get_helm.sh

helm version

Install Metric Server:

kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/high-availability-1.21+.yaml

Steps to Install Prometheus:

--First add repositories

helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

helm repo add grafana https://grafana.github.io/helm-charts

UPDATE HELM CHART REPOS:

helm repo update

helm repo list

CREATE PROMETHEUS NAMESPACE:

kubectl get ns

kubectl create namespace prometheus

kubectl get ns

INSTALL PROMETHEUS:

helm install prometheus prometheus-community/prometheus --namespace prometheus --set alertmanager.persistentVolume.storageClass="gp2" --set server.persistentVolume.storageClass="gp2"

kubectl get pods -n prometheus

kubectl get all -n prometheus

Create Namespace Grafana:

kubectl create namespace grafana

Install Grafana:

helm install grafana grafana/grafana --namespace grafana --set persistence.storageClassName="gp2" --set persistence.enabled=true --set adminPassword='Root123456' --set service.type=LoadBalancer

kubectl get pods -n grafana

kubectl get service -n grafana

--Copy the Instance IP:3000 and paste in browser

--username:admin, password Root123456

--Check SG, nodes and ELB

--Go to Grafana Dashboard-> Add the DataSource--> Select Prometheus and below URL, this URL is same in K8s for all

http://prometheus-server.prometheus.svc.cluster.local/

--https://grafana.com/grafana/dashboards/

--all dashboard id's are here

--Import Grafana dashboard New Import 6417 load

--select Prometheus

import grafana dashboard -->New-> Import -> 315 -->load --> select Prometheus -->import

--Add 1860 port to monitor Nodes individually

11454--> pv and pvc

747-> pod metrics

14623 k8s overview use this

10907 monitor api-server

--to start grafana service or see in script.  
systemctl start grafana-server.service

